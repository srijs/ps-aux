'use strict';
/*jshint asi: true */

var test = require('tap').test
var parse = require('../')().parseLines

var lines = [
    'thlorenz         1050   2.6  1.3  4490356 217636   ??  S     5Aug14 123:03.05 /Applications/iTerm.app/Contents/MacOS/iTerm'
  , '_coreaudiod       257   0.6  0.2  2553344  38572   ??  Ss    5Aug14  32:23.58 /usr/sbin/coreaudiod'
  , '_windowserver     112   0.6  1.7  4949380 292344   ??  Ss    5Aug14 127:03.00 /System/Library/Frameworks/ApplicationServices.framework/Frameworks/CoreGraphics.framework/Resources/W'
  , 'thlorenz        11837   0.4  0.2  1087784  34020   ??  S     5Aug14  33:35.14 /Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO'
  , 'thlorenz        74834   0.2  0.8  1157044 132424   ??  S    Tue10AM  63:55.91 /Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO'
  , 'thlorenz         1991   0.1  1.0  2668480 161944   ??  Ss    5Aug14  11:42.68 tmux new -s v8'
  , 'thlorenz         9667   0.1  1.2  3885840 194972   ??  S     7:06PM   2:21.76 /Applications/Slack.app/Contents/MacOS/Slack'
  , 'thlorenz          642   0.1  1.5  2015524 246252   ??  S     5Aug14 188:19.45 /Applications/Google Chrome.app/Contents/MacOS/Google Chrome'
  , 'thlorenz        24651   0.0  0.2  2606336  34212 s004  S+   11:45AM   0:05.18 /usr/local/Cellar/macvim/7.4-71/MacVim.app/Contents/MacOS/Vim lib/ps-aux.js'
  , 'root            23525   0.0  0.3  2579560  46072   ??  Ss   11:31AM   0:00.28 /usr/sbin/ocspd'
  , 'thlorenz        23211   0.0  0.0  2489688   2784 s004  Ss   11:29AM   0:00.16 -bash'
  , 'thlorenz        23210   0.0  0.0  2436504    856 s010  S+   11:29AM   0:00.00 tmux new -s perfgraph'
  , 'thlorenz        22258   0.0  0.1  3042808  12768 s010  T    11:19AM   0:00.05 node'
  , 'thlorenz        22042   0.0  0.0  2465112   1992 s010  Ss   11:17AM   0:00.14 -bash'
  , 'thlorenz        21491   0.0  0.5  2814552  85728   ??  S    11:13AM   0:02.20 /Applications/Xcode.app/Contents/Applications/Instruments.app/Contents/MacOS/Instruments'
  , 'thlorenz        21370   0.0  0.7   993428 111160   ??  S    11:11AM   0:12.93 /Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO'
  , 'thlorenz        21298   0.0  0.1  3073532  14208 s009  S+   11:10AM   0:00.07 node --expose-gc'
  , 'thlorenz        21218   0.0  0.0  2461016   2004 s009  Ss   11:10AM   0:00.03 -bash'
  , 'thlorenz        21118   0.0  0.0  2481496   2108 s008  Ss+  11:10AM   0:00.09 -bash'
  , 'thlorenz        21003   0.0  0.1  2564756  10524   ??  S    11:07AM   0:01.36 /System/Library/Input Methods/PressAndHold.app/Contents/MacOS/PressAndHold'
  , 'thlorenz        20163   0.0  0.1  2578196  20684   ??  S    10:35AM   0:08.20 /Applications/BetterTouchTool.app/Contents/MacOS/BetterTouchTool'
  , 'thlorenz        19700   0.0  0.0  2477604   4400   ??  Ss   10:19AM   0:00.01 com.apple.ColorSyncXPCAgent'
  , 'thlorenz        19695   0.0  0.1  2578908  10780   ??  S    10:19AM   0:00.27 /System/Library/Image Capture/Support/Image Capture Extension.app/Contents/MacOS/Image Capture Extensi'
  , 'thlorenz        19692   0.0  0.0  2488884   4528   ??  Ss   10:19AM   0:00.01 com.apple.Preview.TrustedBookmarksService'
  , 'thlorenz        19686   0.0  0.8  3972568 133476   ??  S    10:19AM   0:08.25 /Applications/Preview.app/Contents/MacOS/Preview -psn_0_3859374'
  , '_coreaudiod     19157   0.0  0.0  2512496   5028   ??  Ss    9:56AM   0:00.03 com.apple.audio.ComponentHelper'
  , 'root            19153   0.0  0.0  2537712   3960   ??  Ss    9:56AM   0:00.06 /usr/libexec/AirPlayXPCHelper'
  , '_netbios        19041   0.0  0.0  2514864   2664   ??  SNs   9:53AM   0:00.06 /usr/sbin/netbiosd'
]

var expected = [ 
  { user: 'thlorenz',
    pid: 1050,
    '%cpu': 2.6,
    '%mem': 1.3,
    vsz: 4490356,
    rss: 217636,
    tty: '??',
    state: 'S',
    started: '5Aug14',
    time: '123:03.05',
    command: '/Applications/iTerm.app/Contents/MacOS/iTerm' },
  { user: '_coreaudiod',
    pid: 257,
    '%cpu': 0.6,
    '%mem': 0.2,
    vsz: 2553344,
    rss: 38572,
    tty: '??',
    state: 'Ss',
    started: '5Aug14',
    time: '32:23.58',
    command: '/usr/sbin/coreaudiod' },
  { user: '_windowserver',
    pid: 112,
    '%cpu': 0.6,
    '%mem': 1.7,
    vsz: 4949380,
    rss: 292344,
    tty: '??',
    state: 'Ss',
    started: '5Aug14',
    time: '127:03.00',
    command: '/System/Library/Frameworks/ApplicationServices.framework/Frameworks/CoreGraphics.framework/Resources/W' },
  { user: 'thlorenz',
    pid: 11837,
    '%cpu': 0.4,
    '%mem': 0.2,
    vsz: 1087784,
    rss: 34020,
    tty: '??',
    state: 'S',
    started: '5Aug14',
    time: '33:35.14',
    command: '/Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO' },
  { user: 'thlorenz',
    pid: 74834,
    '%cpu': 0.2,
    '%mem': 0.8,
    vsz: 1157044,
    rss: 132424,
    tty: '??',
    state: 'S',
    started: 'Tue10AM',
    time: '63:55.91',
    command: '/Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO' },
  { user: 'thlorenz',
    pid: 1991,
    '%cpu': 0.1,
    '%mem': 1,
    vsz: 2668480,
    rss: 161944,
    tty: '??',
    state: 'Ss',
    started: '5Aug14',
    time: '11:42.68',
    command: 'tmux new -s v8' },
  { user: 'thlorenz',
    pid: 9667,
    '%cpu': 0.1,
    '%mem': 1.2,
    vsz: 3885840,
    rss: 194972,
    tty: '??',
    state: 'S',
    started: '7:06PM',
    time: '2:21.76',
    command: '/Applications/Slack.app/Contents/MacOS/Slack' },
  { user: 'thlorenz',
    pid: 642,
    '%cpu': 0.1,
    '%mem': 1.5,
    vsz: 2015524,
    rss: 246252,
    tty: '??',
    state: 'S',
    started: '5Aug14',
    time: '188:19.45',
    command: '/Applications/Google Chrome.app/Contents/MacOS/Google Chrome' },
  { user: 'thlorenz',
    pid: 24651,
    '%cpu': 0,
    '%mem': 0.2,
    vsz: 2606336,
    rss: 34212,
    tty: 's004',
    state: 'S+',
    started: '11:45AM',
    time: '0:05.18',
    command: '/usr/local/Cellar/macvim/7.4-71/MacVim.app/Contents/MacOS/Vim lib/ps-aux.js' },
  { user: 'root',
    pid: 23525,
    '%cpu': 0,
    '%mem': 0.3,
    vsz: 2579560,
    rss: 46072,
    tty: '??',
    state: 'Ss',
    started: '11:31AM',
    time: '0:00.28',
    command: '/usr/sbin/ocspd' },
  { user: 'thlorenz',
    pid: 23211,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2489688,
    rss: 2784,
    tty: 's004',
    state: 'Ss',
    started: '11:29AM',
    time: '0:00.16',
    command: '-bash' },
  { user: 'thlorenz',
    pid: 23210,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2436504,
    rss: 856,
    tty: 's010',
    state: 'S+',
    started: '11:29AM',
    time: '0:00.00',
    command: 'tmux new -s perfgraph' },
  { user: 'thlorenz',
    pid: 22258,
    '%cpu': 0,
    '%mem': 0.1,
    vsz: 3042808,
    rss: 12768,
    tty: 's010',
    state: 'T',
    started: '11:19AM',
    time: '0:00.05',
    command: 'node' },
  { user: 'thlorenz',
    pid: 22042,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2465112,
    rss: 1992,
    tty: 's010',
    state: 'Ss',
    started: '11:17AM',
    time: '0:00.14',
    command: '-bash' },
  { user: 'thlorenz',
    pid: 21491,
    '%cpu': 0,
    '%mem': 0.5,
    vsz: 2814552,
    rss: 85728,
    tty: '??',
    state: 'S',
    started: '11:13AM',
    time: '0:02.20',
    command: '/Applications/Xcode.app/Contents/Applications/Instruments.app/Contents/MacOS/Instruments' },
  { user: 'thlorenz',
    pid: 21370,
    '%cpu': 0,
    '%mem': 0.7,
    vsz: 993428,
    rss: 111160,
    tty: '??',
    state: 'S',
    started: '11:11AM',
    time: '0:12.93',
    command: '/Applications/Google Chrome.app/Contents/Versions/36.0.1985.125/Google Chrome Helper.app/Contents/MacO' },
  { user: 'thlorenz',
    pid: 21298,
    '%cpu': 0,
    '%mem': 0.1,
    vsz: 3073532,
    rss: 14208,
    tty: 's009',
    state: 'S+',
    started: '11:10AM',
    time: '0:00.07',
    command: 'node --expose-gc' },
  { user: 'thlorenz',
    pid: 21218,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2461016,
    rss: 2004,
    tty: 's009',
    state: 'Ss',
    started: '11:10AM',
    time: '0:00.03',
    command: '-bash' },
  { user: 'thlorenz',
    pid: 21118,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2481496,
    rss: 2108,
    tty: 's008',
    state: 'Ss+',
    started: '11:10AM',
    time: '0:00.09',
    command: '-bash' },
  { user: 'thlorenz',
    pid: 21003,
    '%cpu': 0,
    '%mem': 0.1,
    vsz: 2564756,
    rss: 10524,
    tty: '??',
    state: 'S',
    started: '11:07AM',
    time: '0:01.36',
    command: '/System/Library/Input Methods/PressAndHold.app/Contents/MacOS/PressAndHold' },
  { user: 'thlorenz',
    pid: 20163,
    '%cpu': 0,
    '%mem': 0.1,
    vsz: 2578196,
    rss: 20684,
    tty: '??',
    state: 'S',
    started: '10:35AM',
    time: '0:08.20',
    command: '/Applications/BetterTouchTool.app/Contents/MacOS/BetterTouchTool' },
  { user: 'thlorenz',
    pid: 19700,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2477604,
    rss: 4400,
    tty: '??',
    state: 'Ss',
    started: '10:19AM',
    time: '0:00.01',
    command: 'com.apple.ColorSyncXPCAgent' },
  { user: 'thlorenz',
    pid: 19695,
    '%cpu': 0,
    '%mem': 0.1,
    vsz: 2578908,
    rss: 10780,
    tty: '??',
    state: 'S',
    started: '10:19AM',
    time: '0:00.27',
    command: '/System/Library/Image Capture/Support/Image Capture Extension.app/Contents/MacOS/Image Capture Extensi' },
  { user: 'thlorenz',
    pid: 19692,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2488884,
    rss: 4528,
    tty: '??',
    state: 'Ss',
    started: '10:19AM',
    time: '0:00.01',
    command: 'com.apple.Preview.TrustedBookmarksService' },
  { user: 'thlorenz',
    pid: 19686,
    '%cpu': 0,
    '%mem': 0.8,
    vsz: 3972568,
    rss: 133476,
    tty: '??',
    state: 'S',
    started: '10:19AM',
    time: '0:08.25',
    command: '/Applications/Preview.app/Contents/MacOS/Preview -psn_0_3859374' },
  { user: '_coreaudiod',
    pid: 19157,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2512496,
    rss: 5028,
    tty: '??',
    state: 'Ss',
    started: '9:56AM',
    time: '0:00.03',
    command: 'com.apple.audio.ComponentHelper' },
  { user: 'root',
    pid: 19153,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2537712,
    rss: 3960,
    tty: '??',
    state: 'Ss',
    started: '9:56AM',
    time: '0:00.06',
    command: '/usr/libexec/AirPlayXPCHelper' },
  { user: '_netbios',
    pid: 19041,
    '%cpu': 0,
    '%mem': 0,
    vsz: 2514864,
    rss: 2664,
    tty: '??',
    state: 'SNs',
    started: '9:53AM',
    time: '0:00.06',
    command: '/usr/sbin/netbiosd' } 
] 

function inspect(obj, depth) {
  console.error(require('util').inspect(obj, false, depth || 5, true));
}

test('\nparsing a bunch of lines of process info', function (t) {
  var res = parse(lines);
  t.deepEqual(res, expected, 'parses all lines correctly')
  t.end()
})
